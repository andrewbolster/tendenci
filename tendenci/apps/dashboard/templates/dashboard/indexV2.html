{% load theme_tags %}
{% load dashboard_tags %}
{% load i18n %}
{% theme_extends "base-wide.html" %}

{% block title %}Dashboard{% endblock %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui/jquery-ui-1.8.2.custom.css">
<link rel="stylesheet" href="{{ STATIC_URL }}css/dashboard.css">
{% endblock %}

{% block body %}
{% dashboard_nav user %}
<div class="main-panel">

    {% if "Self-Signup" == SITE_DEVELOPER_PARTNER|join:"" %}
        {% if user.is_superuser %}
	        {% if not has_paid and activate_url %}
			<div class=" alert-message block-message fade in" data-alert="alert">
				<a class="close" href="#">×</a>
				Your free trial period {% if expired %}expired{% else %}expires{% endif %} on {{ expiration_dt }}.
				<div class="alert-actions">
		            <a class="btn" href="{{ activate_url }}">Activate Your Account</a>
		        </div> 
			</div>
			{% endif %}        
        <div class="alert-message block-message fade in success" data-alert="alert">
        <a class="close" href="#">×</a>
        <p><strong>Welcome to the Tendenci Dashboard!</strong></p>
        <p>Your Tendenci site comes with a built-in guide to get you started. In includes basic concepts like adding pages and other content, editing your navigation, uploading photos, and other general topics.</p>
        <div class="alert-actions">
            <a class="btn" href="{% url tendenci_guide.guide_page "getting-started-with-tendenci" %}">Go to the Guide</a>
        </div>
    </div>
        {% endif %}
    {% endif %}

    <div class="dashboard-stats">
        <!-- Events Table -->
        {% if events %}
        <div class="stat">
            <span>{% trans "Events" %}</span>
            <table class="events-table">
                <tr>
                    <th>{% trans "Date" %}</th>
                    <th>{% trans "Name" %}</th>
                    <th>{% trans "Registrations" %}</th>
                    <th>{{ SITE_GLOBAL_CURRENCYSYMBOL }}</th>
                    <th>{% trans "Paid" %} %</th>
                </tr>
                {% for date,name,url,reg,total,percentage in events %}
                <tr>
                    <td>{{ date }}</td>
                    <td><a href="{{ url }}">{{ name }}</a></td>
                    <td>{{ reg }}</td>
                    <td>{{ total }}</td>
                    <td>{{ percentage }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
        {% if members %}
        <div class="left-stat stat">
            <span>{% trans "Members" %}</span>

            {% for active, expiring, new, pending, expired in members %}
            <p class="members-header">{{ active }} Active | {{ expiring }} Expire in 30 days</p>
            <div id="members-info">
                Last 30 days
                <p>New: {{ new }}</p>
                <p>Pending: {{ pending }}</p>
                <p>Expired: {{ expired }}</p>
                {% endfor %}
            </div>
            <div id="members-graph"></div>
            <div style="clear:both;"></div>
            {% if corp_new %}
            <div class="members-item">
                <p class="members-header">Corporate Memberships in the Past 30 Days</p>
                <ol>
                    {% for name, url in corp_new %}
                    <li><a href="{{ url }}">{{ name }}</a></li>
                    {% endfor %}
                </ol> 
            </div>
            {% endif %}
            {% if corp_renew %}
            <div class="members-item">
                <p class="members-header">Renewed Corporate Memberships in the Past 30 Days</p>
                <ol>
                    {% for name, url in corp_renew %}
                    <li><a href="{{ url }}">{{ name }}</a></li>
                    {% endfor %}
                </ol> 
            </div>
            {% endif %}
            {% if corp_expired %}
            <div class="members-item">
                <p class="members-header">Expired Corporate Memberships in the Past 30 Days</p>
                <ol>
                    {% for name, url in corp_expired %}
                    <li><a href="{{ url }}">{{ name }}</a></li>
                    {% endfor %}
                </ol> 
            </div>
            {% endif %}
            {% if corp_expiring %}
            <div class="members-item">
                <p class="members-header">Upcoming Expiring Corporate Memberships</p>
                <ol>
                    {% for name, url in corp_expiring %}
                    <li><a href="{{ url }}">{{ name }}</a></li>
                    {% endfor %}
                </ol> 
            </div>
            {% endif %}
        </div>
        {% endif %}
        <div class="right-stat">
            {% if forms %}
            <div class="stat">
                <span>{% trans "Forms" %}</span>
                <table>
                    <tr>
                        <th>{% trans "Name" %}</th>
                        <th>30 {% trans "Day Submissions" %}</th>
                    </tr>
                    {% for title, url, count, link in forms %}
                    <tr>
                        <td><a href="{{ url }}">{{ title }}</a></td>
                        <td><a href="{{ link }}">{{ count }}</a></td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
            {% endif %}
            {% if pages_traffic or events_traffic %}
            <div class="stat">
                <span>{% trans "Traffic" %}</span>
                {% if pages_traffic %}
                <table>
                {% for title, url, count in pages_traffic %}
                    <tr>
                    {% if forloop.first %}
                        <th>{% trans "Pages" %}</th>
                        <th>{{ count }}</th>
                    {% else %}
                        <td><a href="{{ url }}">{{ title }}</a></td>
                        <td>{{ count }}</td>
                    {% endif %}
                    </tr>
                {% endfor %}
                </table>
                {% endif %}

                {% if events_traffic %}
                <table>
                {% for title, url, count in events_traffic %}
                    <tr>
                    {% if forloop.first %}
                        <th>{% trans "Events" %}</th>
                        <th>{{ count }}</th>
                    {% else %}
                        <td><a href="{{ url }}">{{ title }}</a></td>
                        <td>{{ count }}</td>
                    {% endif %}
                    </tr>
                {% endfor %}
                </table>
                {% endif %}
            </div>
            {% endif %}

            {% if corp_members %}
            <div class="stat">
                <span>{% trans "Top Corporate Memberships" %}</span>
                <table>
                {% for title, url, count in corp_members %}
                    <tr>
                    {% if forloop.first %}
                        <th>{% trans "Corporate Members" %}</th>
                        <th>{{ count }}</th>
                    {% else %}
                        <td><a href="{{ url }}">{{ title }}</a></td>
                        <td>{{ count }}</td>
                    {% endif %}
                    </tr>
                {% endfor %}
                </table>
            </div>
            {% endif %}
        </div>

        <div style="clear:both;"></div>
    </div>
</div>

<div class="side-panel">
	{% if user.is_superuser %}
	<div class="admin-quick-links">
    <h3>{% trans "Admin Quick Links" %}</h3>
	<ul>
		{% if MODULE_PAGES_ENABLED %}
    	<li><a href="{% url page.add %}">{% trans "Add a page" %}</a></li>
		{% endif %}

		<li><a href="{% url haystack_search %}">{% trans "Search All Modules" %}</a></li>

		<!--<li><a href="{% url entity.search %}">Search entities</a></li>
    	<li><a href="javascript:;">Edit navigation</a></li>
    	<li><a href="{% url event_log.search %}">Search event logs</a></li>
    	<li><a href="{% url profile.search %}">Search users</a></li>-->
    	<li><a href="{% url import.user_upload_add %}">{% trans "Import Users" %}</a></li>
    	<!-- <li><a href="{% url settings %}">Change website settings</a></li> -->
    	<li><a href="{% url settings %}">{% trans "Enable/Disable modules" %}</a></li>
    	<!-- <li><a href="javascript:;">Update SEM</a></li> -->
        <li><a href="{% url clear_cache %}">{% trans "Clear Cache" %}</a></li>
       <li><a href="{% url theme_editor.editor %}?file=/templates/homepage.html">{% trans "Theme Editor" %} </a></li>
        <li><a href="/admin/">{% trans "Admin Panel" %}</a></li>
        {% if MODULE_RECURRING_PAYMENTS_ENABLED %}
        <li><a href="{% url recurring_payment.customers %}">{% trans "Recurring Payments" %}</a></li>
        {% endif %}
    </ul>
    </div>
    	
	
    {% endif %}
</div>

<div style="clear:both;"></div>

{% endblock %}

{% block extra_body %}
{{ block.super }}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui-1.8.2.custom.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery_plugins/bar-graph.js"></script>
<script type="text/javascript">
$(function(){
    {% for total, expiring, active, pending, expired in members %}
    var d = [{{ active }}, {{ pending }}, {{ expired }}];
    var c = ["New","Pending","Expired"];
    var h = "Last 30 days"
    $("#members-graph").graph({data:d,categories:c,legend:h});
    {% endfor %}
});
</script>
{% endblock %}
